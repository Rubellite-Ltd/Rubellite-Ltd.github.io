<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Upload Page</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body { font-family: Arial; padding: 20px; background: #f0f0f0; }
.container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; }
.preview { margin-top: 10px; max-width: 100%; max-height: 300px; }
input, select, button { width: 100%; padding: 10px; margin-top: 10px; }
</style>
</head>
<body>

<div class="container">
  <h2>Admin Image Upload</h2>
  
  <input type="file" id="imageInput" accept="image/*">
  <img id="preview" class="preview" src="" alt="Preview" style="display:none;">
  
  <label for="selectedText">Selected Text:</label>
  <input type="text" id="selectedText" placeholder="Enter selected text">
  
  <button id="uploadBtn">Upload</button>

  <p id="status"></p>
</div>

<script>
  // Firebase config
<!--  const firebaseConfig = {-->
<!--    apiKey: "YOUR_API_KEY",-->
<!--    authDomain: "YOUR_PROJECT.firebaseapp.com",-->
<!--    projectId: "YOUR_PROJECT_ID",-->
<!--    storageBucket: "YOUR_PROJECT.appspot.com",-->
<!--    messagingSenderId: "YOUR_SENDER_ID",-->
<!--    appId: "YOUR_APP_ID"-->
<!--  };-->
    const firebaseConfig = {
      apiKey: "AIzaSyB7rDq-uyJF5z8uVZcvD6G12D9t2BWPM0M",
      authDomain: "mydesignapp-29e32.firebaseapp.com",
<!--      databaseURL: "https://mydesignapp-29e32-default-rtdb.firebaseio.com",-->
      projectId: "mydesignapp-29e32",
      storageBucket: "mydesignapp-29e32.firebasestorage.app",
      messagingSenderId: "272487898851",
      appId: "1:272487898851:web:dad68474d8cd62c2506fd6",
      measurementId: "G-PZTNF40WG4"
    };
  firebase.initializeApp(firebaseConfig);

  const db = firebase.firestore();
  const storage = firebase.storage();

  const imageInput = document.getElementById('imageInput');
  const preview = document.getElementById('preview');
  const uploadBtn = document.getElementById('uploadBtn');
  const status = document.getElementById('status');
  const selectedTextInput = document.getElementById('selectedText');

  let file;

  imageInput.addEventListener('change', (e) => {
    file = e.target.files[0];
    if(file) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = 'block';
    }
  });

  uploadBtn.addEventListener('click', async () => {
    if(!file) { status.innerText = "Select an image first"; return; }
    if(!selectedTextInput.value) { status.innerText = "Enter selected text"; return; }

    status.innerText = "Uploading...";
    
    try {
      // Upload image to Firebase Storage
      const storageRef = storage.ref().child(`uploads/${Date.now()}_${file.name}`);
      await storageRef.put(file);
      const imageUrl = await storageRef.getDownloadURL();

      // Save selection and image URL to Firestore
      await db.collection('customizations').add({
        selectedText: selectedTextInput.value,
        imageUrl: imageUrl,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      status.innerText = "✅ Uploaded successfully!";
      preview.style.display = 'none';
      imageInput.value = '';
      selectedTextInput.value = '';

    } catch (err) {
      console.error(err);
      status.innerText = "❌ Upload failed!";
    }
  });
</script>

</body>
</html>
